<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Oh Great, Another Cybersecurity Blog</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/dropcast.css') }}">
  <link rel="author" href="Amie Chen for Codrops">
  <link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Rufina:400,700|Source+Sans+Pro:200,300,400,600,700" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/particles.js/2.0.0/particles.min.js"></script>
  <style>
    /* Toast notification */
    @keyframes slideUpFade {
      0% {
        transform: translateX(-50%) translateY(50px);
        opacity: 0;
      }
      30% {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
      }
      100% {
        transform: translateX(-50%) translateY(-50px);
        opacity: 0;
      }
    }

    #toast {
      visibility: hidden;
      min-width: 320px;
      background: linear-gradient(135deg, #2e8b57, #3cb371);
      color: #fff;
      text-align: center;
      border-radius: 12px;
      padding: 18px 25px;
      position: fixed;
      bottom: 60px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 9999;
      font-size: 17px;
      opacity: 0;
    }

    #toast.show {
      visibility: visible;
      animation: slideUpFade 3s ease forwards;
    }

    /* Feedback section styles */
    #feedback-section {
      background-color: #1e1e2f;
      color: #eee;
      padding: 30px;
      border-radius: 12px;
      max-width: 700px;
      margin: 40px auto;
      font-family: 'Rufina', sans-serif;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
      font-size: 15px;
      line-height: 1.6;
    }

    .feedback-form .question,
    .feedback-form label {
      font-size: 15px;
    }

    textarea, select {
      font-size: 16px;
    }

    .feedback-form .question p {
      font-weight: 600;
      margin-bottom: 10px;
    }

    .likert-scale {
      display: flex;
      justify-content: space-between;
      background-color: #2c2c3d;
      padding: 10px 15px;
      border-radius: 8px;
    }

    .likert-scale label {
      flex: 1;
      text-align: center;
      color: #ccc;
    }

    .likert-scale input[type="radio"] {
      display: block;
      margin: 5px auto;
      accent-color: #ff5c5c;
      transform: scale(1.2);
    }

    .feedback-form-button {
      background: linear-gradient(135deg, #ff5c5c, #ff9950);
      color: white;
      font-size: 16px;
      padding: 12px 25px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 20px;
      transition: background 0.3s ease;
    }

    .feedback-form-button:hover {
      background: linear-gradient(135deg, #ff3e3e, #ff7b2d);
    }

    .form-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 2rem;
      justify-content: space-between;
      align-items: flex-start;
    }

    .form-column {
      flex: 1 1 45%;
      min-width: 300px;
    }

    textarea, select {
      width: 100%;
      padding: 0.7em;
      background: #1c1c1c;
      border: 1px solid #444;
      border-radius: 4px;
      color: white;
      font-family: inherit;
    }

    .likert-question {
      margin-bottom: 1em;
    }

    .likert-question > div label {
      margin-right: 10px;
      display: inline-block;
    }
  </style>
</head>

<body>
  <div id="site__bg"></div>
  <div class="main">
    <nav>
      <div class="logo nav__logo">
        <a href="{{ url_for('index') }}"><img src="{{ url_for('static', filename='images/logo.svg') }}" alt="logo"></a>
      </div>
      <ul class="nav__list">
        <li class="nav__item"><a href="{{ url_for('index') }}">Home</a></li>
      </ul>
    </nav>

    <section class="site">
      <h1 class="site__title site__title--separator">Oh Great, Another Cybersecurity Blog</h1>
      <p class="site__description">Hackers never sleep, but that doesn’t mean you have to lose yours...</p>
    </section>

    <section class="episodes">

      {% for ep in [
        {'number': '01', 'title': 'Mess, Managed', 'desc': 'Behind the scenes: How this NLP wizardry works.', 'url': 'about'},
        {'number': '02', 'title': 'TTPs: MITRE’d and Sorted', 'desc': 'Mapped to the MITRE ATT&CK framework.', 'url': 'ttps'},
        {'number': '03', 'title': 'Pretty Pictures of Cyber Doom', 'desc': 'Heat maps, attack timelines, connection graphs.', 'url': 'visuals'},
        {'number': '04', 'title': 'Hacker Shenanigans, Served Fresh', 'desc': 'Dynamic threat reports.', 'url': 'reports'}
      ] %}
      <article class="episode">
        <h2 class="episode__number">{{ ep.number }}</h2>
        {% if ep.number == '03' %}
        <div class="episode__media cybermap-widget">
          <iframe width="100%" height="100%" src="https://cybermap.kaspersky.com/en/widget/dynamic/dark" frameborder="0"></iframe>
        </div>
        {% else %}
        <div class="episode__media"><a href="{{ url_for(ep.url) }}" class="episode__image"></a></div>
        {% endif %}
        <div class="episode__detail">
          <a href="{{ url_for(ep.url) }}" class="episode__title">
            <h4>{{ ep.title }}</h4>
          </a>
          <p class="episode__description">{{ ep.desc }}</p>
        </div>
      </article>
      {% endfor %}

      <!-- Feedback Episode -->
      <article class="episode episode--feedback">
        <h2 class="episode__number">🗳</h2>
        <div class="episode__detail">
          <h4 class="episode__title">We value your feedback</h4>
          <form id="feedbackForm">
            <div class="form-grid">
              <div class="form-column">
                {% for q in ['How useful was the system?', 'How easy was it to use?', 'How visually appealing was it?'] %}
                <div class="likert-question">
                  <label>{{ q }}</label>
                  <div>
                    {% for i in range(1, 6) %}
                    <label><input type="radio" name="q{{ loop.index }}" value="{{ i }}"> {{ i }}</label>
                    {% endfor %}
                  </div>
                </div>
                {% endfor %}
              </div>

              <div class="form-column">
                <div class="likert-question">
                  <label for="experience">Experience Level</label>
                  <select id="experience" name="experience" required>
                    <option value="" disabled selected>Select your experience</option>
                    {% for level in ['Fresher', 'Intermediate', 'Professional', 'Expert'] %}
                    <option value="{{ level }}">{{ level }}</option>
                    {% endfor %}
                  </select>
                </div>

                <div class="likert-question">
                  <label for="userFeedback">Tell us your thoughts</label>
                  <textarea id="userFeedback" name="feedback" rows="5" placeholder="Share your experience..."></textarea>
                </div>
              </div>
            </div>

            <div style="margin-top: 1em; text-align: center;">
              <button type="submit" class="feedback-form-button">Submit Feedback</button>
            </div>
          </form>
        </div>
      </article>

      <div id="toast"></div>
    </section>
  </div>

  <footer>
    <p class="footer__content">
      Just what the internet needed: another blog post!
      <span class="footer__template">by &#169; Anjali Panchal.</span>
    </p>
    <div class="logo footer__logo">
      <a href="{{ url_for('index') }}"><img src="{{ url_for('static', filename='images/logo-white.svg') }}" alt="logo" /></a>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <script src="{{ url_for('static', filename='js/dropcast.js') }}"></script>
  <script>
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = "show";

      confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });

      setTimeout(() => {
        toast.className = toast.className.replace("show", "");
      }, 5000);
    }

    document.getElementById('feedbackForm').addEventListener('submit', async function (e) {
      e.preventDefault();

      const q1 = document.querySelector('input[name="q1"]:checked')?.value;
      const q2 = document.querySelector('input[name="q2"]:checked')?.value;
      const q3 = document.querySelector('input[name="q3"]:checked')?.value;
      const feedback = document.getElementById("userFeedback")?.value || "";
      const experience = document.getElementById("experience")?.value;

      if (!q1 || !q2 || !q3) {
        showToast("⚠️ Please answer all questions.");
        return;
      }

      const res = await fetch('/feedback', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ q1, q2, q3, feedback, experience })
      });

      const result = await res.json();
      showToast(result.message || "Thank you! Feedback submitted!");

      // Clear form
      document.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);
      document.getElementById("userFeedback").value = "";
      document.getElementById("experience").value = "";
    });
  </script>
</body>

</html>
